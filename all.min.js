 $(".settings-item").click(function() {

    var toggleSwitch = $(this).find(".toggle-switch input");

    if (toggleSwitch.prop("checked")) {
        toggleSwitch.prop("checked", false).change();
    } else {
        toggleSwitch.prop("checked", true).change();
    }
});

$(`.settings-item .toggle-switch,
   .settings-item .btn,
   .settings-item .material-icons`).click(function(e) {
    e.stopPropagation();
}); $(document).on("click", function() {
    $(".context-menu").removeClass("visible");
});

$(".app").scroll(function() {
    $(".context-menu").removeClass("visible");
});

function openContextMenu(content, container, e) {

    e.preventDefault();

    if (content !== undefined) {
        $(container).html(content);
    }

    var scope = "body";

    if (($(scope).width() - e.clientX - 6 - $(container).width() - 10) < 0) {
        var normalizedX = $(scope).width() - $(container).width() - 10;
    } else {
        var normalizedX = e.clientX + 6;
    }

    if (($(scope).height() - e.clientY - 4 - $(container).height() - 10) < 0) {
        var normalizedY = $(scope).height() - $(container).height() - 10;
    } else {
        var normalizedY = e.clientY + 4;
    }

    $(container).css("top", normalizedY);
    $(container).css("left", normalizedX);

    if (!$(container).hasClass("visible")) {
        $(container).addClass("visible");
    }
} $(document).on("click", ".modern-dropdown button", function() {
    if ($(this).closest(".modern-dropdown").find(".dropdown-content").css("display") == "none") {
        $(".dropdown-content").hide();
        $(".modern-dropdown").removeClass("dropdown-active");
        $(this).closest(".modern-dropdown").find(".dropdown-content").fadeIn(100);
        $(this).closest(".modern-dropdown").addClass("dropdown-active");
    } else {
        $(this).closest(".modern-dropdown").find(".dropdown-content").fadeOut(100);
        $(this).closest(".modern-dropdown").removeClass("dropdown-active");
    }
});

$(document).on("click", function(e) {
    if (!$(e.target).closest(".modern-dropdown").length) {
        $(".dropdown-content").fadeOut(100);
        $(".modern-dropdown").removeClass("dropdown-active");
    }
}); $(".menu, .app").scroll(function() {
    if ($(this).scrollTop() > 0) {
        $(".navbar").addClass("when-scrolled");
    } else {
        $(".navbar").removeClass("when-scrolled");
    }
}); var mobile = false;

if ($(document).innerWidth() < 700) {
    mobile = true;
}

$(window).on("resize", function() {
    /*if ($(".menu").is(":visible")) {
        if (!mobile) {
            closeMenu();
        }
    }*/
    if ($(document).innerWidth() < 700) {
        mobile = true;
    } else {
        mobile = false;
    }
});

function openMenu() {
    if (mobile) {
        $(".menu").show();
        $(".menu").removeClass("closed");
    } else {
        $(".app").fadeOut(250).promise().done(function() {
            $(".menu").show();
            $(".app").fadeIn(250);
            $(".menu").removeClass("closed");
        });
    }
}

function closeMenu() {
    if (mobile) {
        $(".menu").addClass("closed");
        setTimeout(function() {
            $(".menu").hide();
        }, 300);
    } else {
        $(".menu").addClass("closed");
        $(".app").fadeOut(250).promise().done(function() {
            $(".menu").hide();
            $(".app").fadeIn(250);
        });
    }
}

if (mobile) {
    $(".menu").hide();
    $(".menu").addClass("closed");
}

$(".nav-title .open-menu").click(function() {
    if (!$(".menu").is(":visible")) {
        openMenu();
    } else {
        closeMenu();
    }
});

$(".menu-title .close-menu").click(function() {
    closeMenu();
});

$(".menu-button").click(function() {
    if (mobile) {
        setTimeout(function() {
            closeMenu();
        }, 300);
    }
});

$(document).mouseup(function(e) {

    if (mobile) {

        var container = $(".menu");

        if (!container.is(e.target) && container.has(e.target).length === 0) {
            if ($(".menu").is(":visible")) {
                closeMenu();
            }
        }
    }
}); var loaderDelay = 800;

function loader(show, color) {

    if ($(".loader-shadow").length == 0) {
        $("body").append(`
            <div class="loader-shadow primary">
                <div class="loader-container">
                    <div class="loader">
                        <svg class="circular" viewBox="25 25 50 50">
                            <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="6" stroke-miterlimit="20" />
                        </svg>
                    </div>
                </div>
            </div>
        `);
    }

    if (show) {

        if (color !== undefined) {
            $(".loader-shadow").attr("class", "loader-shadow " + color);
        }

        loaderRequested = true;

        //console.log("WAITING " + loaderDelay.toString());

        setTimeout(function() {

            if (loaderRequested) {
                $(".loader-shadow").fadeIn(150);
                //console.log("LOADER SHOW");
            } else {
                //console.log("NOT ENOUGH TIME TO SHOW LOADER");
            }
        }, loaderDelay);
    } else {
        //console.log("ABORTED");
        loaderRequested = false;
        setTimeout(function() {
            $(".loader-shadow").fadeOut(150);
        }, 100);
    }
} // Without animation
$(document).on("click", ".horizontal-menu:not(.animated) button", function() {
    $(this).closest(".horizontal-menu").find("button").removeClass("btn-active");
    $(this).addClass("btn-active");
});

// With animation
$(document).on("click", ".horizontal-menu.animated button", function() {
    $(this).closest(".horizontal-menu").find("button").removeClass("btn-active");
    $(this).addClass("btn-active");
    displayHorizontalMenu($(this).closest(".horizontal-menu"));
});

function displayHorizontalMenu(menu) {
    console.log("gg");
    var slider = menu.find(".slider");
    slider.css("width", (menu.find(".btn-active").outerWidth() - 16).toString() + "px");
    slider.css("left", (menu.find(".btn-active").offset().left - menu.offset().left + 8).toString() + "px");
    slider.attr("class", "slider");
    slider.addClass(menu.find(".btn-active").data("color"));
} $(document).on("click", ".ripple-effect", function(e) {
    
    var button = e.currentTarget;

    var circle = document.createElement("span");
    var diameter = Math.max(button.clientWidth, button.clientHeight) / 2;
    var radius = diameter / 2;

    $(circle).css("width", `${diameter}px`);
    $(circle).css("height", `${diameter}px`);

    $(circle).css("top", `${e.pageY - ($(button).offset().top + radius)}px`);
    $(circle).css("left", `${e.pageX - ($(button).offset().left + radius)}px`);

    $(circle).addClass("ripple");

    $(button).append(circle);

    setTimeout(function() {
        circle.remove();
    }, 400)
}); function createDiagram(diagram, names, colors, values) {
    $(diagram).empty();

    if (names.length == 0) {
        $(diagram).removeClass("diagram-container");
        $(diagram).append('<i class="material-icons">visibility_off</i>');
        return;
    }

    if (!$(diagram).hasClass("diagram-container")) {
        $(diagram).addClass("diagram-container");
    }

    var maxValue = 0;
    for (let i = 0; i < names.length; i++) {
        if (values[i] > maxValue) {
            maxValue = values[i];
        }
    }
    if (maxValue < 14) {
        maxValue = 14;
    }

    var diagramHeight = $(diagram).width() / 2 + 8;
    var scaleFactor = $(diagram).width() / 2 / maxValue;

    for (let i = 0; i < names.length; i++) {
        let height = scaleFactor * values[i]
        let offsetTop = diagramHeight - height;
        $(diagram).append(`<div class="diagram-bar ${colors[i]}"
            data-name="${names[i]}"
            data-percent="${values[i]}%"
            style="height: ${height}px; margin-top: ${offsetTop}px"></div>`);
    }

    $(diagram).css("height", diagramHeight + "px");
    $(window).on("resize", function() {
        vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
        $(diagram).css("max-width", (vw - 80) + "px");
    });
} $("#search-bar form").click(function() {
	$("#search-bar input").focus();
});

$("#search-bar input").focusin(function() {
	$("#search-bar").addClass("search-bar-active");
});

$("#search-bar input").focusout(function() {
	$("body").one("mouseup", function() {
		$("#search-bar").removeClass("search-bar-active");
		$("#search-bar input").val("");
		$("#search-list").hide();
	});
}); applyTheme();

function applyTheme() {
    if (localStorage.getItem("auto-theme") == "enabled") {
        $(".settings-item:has(.dark-theme-toggle-switch)").addClass("disabled");
        $(".auto-dark-theme-toggle-switch input").prop("checked", true);
        var darkTheme = window.matchMedia("(prefers-color-scheme: dark)");
        if (darkTheme.matches) {
            enableDarkTheme(true);
        } else {
            enableDarkTheme(false);
        }
    } else {
        $(".settings-item:has(.dark-theme-toggle-switch)").removeClass("disabled");
        $(".auto-dark-theme-toggle-switch input").prop("checked", false);
        if (localStorage.getItem("theme") == "dark-theme") {
            enableDarkTheme(true);
        } else {
            enableDarkTheme(false);
        }
    }
}

function enableDarkTheme(enable) {
    if (enable) {
        localStorage.setItem("theme", "dark-theme");
        $(".dark-theme-toggle-switch input").prop("checked", true);
        $("body").addClass("during-transition");
        $("body").addClass("dark-theme");
        setTimeout(function() {
            $("body").removeClass("during-transition");
        }, 200);
    } else {
        localStorage.setItem("theme", "light-theme");
        $(".dark-theme-toggle-switch input").prop("checked", false);
        $("body").addClass("during-transition");
        $("body").removeClass("dark-theme");
        setTimeout(function() {
            $("body").removeClass("during-transition");
        }, 200);
    }
}

function enableAutoDarkTheme(enable) {
    if (enable) {
        localStorage.setItem("auto-theme", "enabled");
    } else {
        localStorage.setItem("auto-theme", "disabled");
    }
    applyTheme();
}

$(".dark-theme-toggle-switch input").change(function() {
    if (this.checked) {
        enableDarkTheme(true);
    } else {
        enableDarkTheme(false);
    }
});

$(".auto-dark-theme-toggle-switch input").change(function() {
    if (this.checked) {
        enableAutoDarkTheme(true);
    } else {
        enableAutoDarkTheme(false);
    }
}); $(document).ready(function() {
    $("body").fadeIn(500);
}); function alertBox(title, text, buttons) {

    if ($(".alert-shadow").length == 0) {
        $("body").append(`
            <div class="alert-shadow">
                <div class="alert">
                    <h2 class="alert-title"></h2>
                    <p class="alert-text"></p>
                    <div class="alert-buttons"></div>
                    <div style="clear: both;"></div>
                </div>
            </div>
        `);
    }

    if ($(".alert-shadow").is(":visible")) {
        $(".alert-shadow").fadeOut(150).promise().done(function() {
            alertBox(title, text, buttons)
        });
    } else {
        $(".alert-title").text(title);
        $(".alert-text").text(text);
        $(".alert-buttons").html(buttons);
        $(".alert-shadow").fadeIn(150);
    }
}

$("body").on("click", ".alert-shadow .cancel", function() {
    $(".alert-shadow").fadeOut(150);
});